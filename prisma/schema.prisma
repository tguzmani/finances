generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
}

model TransactionGroup {
  id           Int                       @id @default(autoincrement())
  description  String
  status       TransactionGroupStatus    @default(NEW)
  createdAt    DateTime                  @default(now()) @map("created_at")
  updatedAt    DateTime                  @updatedAt @map("updated_at")

  transactions Transaction[]

  @@map("transaction_groups")
}

model Transaction {
  id            Int                  @id @default(autoincrement())
  date          DateTime
  amount        Decimal              @db.Decimal(10, 2)
  currency      String               @db.VarChar(10)
  transactionId String               @unique @map("transaction_id")
  status        TransactionStatus    @default(NEW)
  createdAt     DateTime             @default(now()) @map("created_at")
  updatedAt     DateTime             @updatedAt @map("updated_at")
  type          TransactionType      @default(EXPENSE)
  description   String?
  platform      TransactionPlatform
  method        PaymentMethod?
  groupId       Int?                 @map("group_id")
  group         TransactionGroup?    @relation(fields: [groupId], references: [id])

  @@map("transactions")
}

model Exchange {
  id               Int            @id @default(autoincrement())
  orderNumber      String         @unique @map("order_number")
  asset            String         @db.VarChar(10)
  amount           Decimal        @db.Decimal(18, 8)
  amountGross      Decimal        @map("amount_gross") @db.Decimal(18, 8)
  fiatSymbol       String         @map("fiat_symbol") @db.VarChar(3)
  fiatAmount       Decimal        @map("fiat_amount") @db.Decimal(18, 2)
  exchangeRate     Decimal        @map("exchange_rate") @db.Decimal(18, 4)
  counterparty     String?        @db.VarChar(255)
  tradeType        TradeType      @map("trade_type")
  status           ExchangeStatus @default(COMPLETED)
  binanceCreatedAt DateTime       @map("binance_created_at")
  createdAt        DateTime       @default(now()) @map("created_at")
  updatedAt        DateTime       @updatedAt @map("updated_at")

  @@index([binanceCreatedAt])
  @@index([status])
  @@map("exchanges")
}

model ExchangeRate {
  id     Int                 @id @default(autoincrement())
  date   DateTime            @default(now())
  value  Decimal             @db.Decimal(10, 2)
  source ExchangeRateSource  @default(INTERNAL)

  @@index([date])
  @@index([source])
  @@map("exchange_rates")
}

enum TransactionStatus {
  NEW
  REVIEWED
  REGISTERED
  REJECTED
}

enum TransactionGroupStatus {
  NEW
  REGISTERED
}

enum TransactionType {
  EXPENSE
  INCOME
}

enum TransactionPlatform {
  BANESCO
  BINANCE
  BANK_OF_AMERICA
  WALLET
  CASH_BOX
}

enum PaymentMethod {
  DEBIT_CARD
  PAGO_MOVIL
  ZELLE
  CREDIT_CARD
  BINANCE_PAY
  DEPOSIT
  WITHDRAWAL
  CASH
}

enum ExchangeStatus {
  COMPLETED
  PROCESSING
  PENDING
  CANCELLED
  FAILED
  REVIEWED
  REJECTED
  REGISTERED
}

enum TradeType {
  BUY
  SELL
}

enum ExchangeRateSource {
  INTERNAL
  BINANCE_P2P
  BCV
}
